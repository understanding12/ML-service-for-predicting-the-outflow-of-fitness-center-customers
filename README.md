# ML project Predicting Customer Churn for a Gym

![ML project Churn prediction](/EDA/feature-importance.png)

## Problem statement

–°–µ—Ä–≤–∏—Å—ã –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ –æ–∫—Ä—É–∂–∞—é—Ç –Ω–∞—Å –ø–æ–≤—Å—é–¥—É ‚Äî –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –¥–æ –æ–±–ª–∞—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, Netflix –∏ ChatGPT. –£–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–∫—Ç–æ—Ä–æ–º –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —É—Å–ø–µ—Ö–∞ —Ç–∞–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π.

–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–∞—Å—Ç–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Ä–æ–∂–µ ‚Äî ¬´–≤ 5‚Äì25 —Ä–∞–∑ –¥–æ—Ä–æ–∂–µ, —á–µ–º —É–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ¬ª (Harvard Business Review). –≠—Ç–æ –ª–æ–≥–∏—á–Ω–æ: –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –∏ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ø–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –≤–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, –∫—Ç–æ —É–∂–µ —É –≤–∞—Å –µ—Å—Ç—å.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º—É —Ä–æ—Å—Ç—É –ø—Ä–∏–±—ã–ª–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.

–ë–∏–∑–Ω–µ—Å—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–æ—á–Ω–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ç–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å proactively –≤–Ω–µ–¥—Ä—è—Ç—å —Ü–µ–ª–µ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –æ—Ç—Ç–æ–∫–∞ –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–æ–≤.

–Ø —Ä–µ—à–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤—ã–±—Ä–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ [–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –∏ –æ—Ç—Ç–æ–∫–æ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω–æ–≥–æ –∑–∞–ª–∞ —Å Kaggle].(https://www.kaggle.com/datasets/adrianvinueza/gym-customers-features-and-churn).

## üî¢ Dataset

[CSV file](/data/gym_churn_us.csv) –≤–∫–ª—é—á–∞–µ—Ç 4000 —Å—Ç—Ä–æ–∫ –∏ 14 –∫–æ–ª–æ–Ω–æ–∫.

**Structure**: 
- features: gender, near_location, partner, promo_friends, phone, group_visits, age
- financial: contract_period, avg_additional_charges_total, month_to_end_contract, lifetime, avg_class_frequency_total, avg_class_frequency_current_month
- labels: churn - 1 if customer unsubscribed

## üìä EDA

–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ö–æ—Ä–æ—à–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω, –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

–ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑—É—á–∏—Ç—å –≤ [Jupyter notebook](/churn-prediction-3.ipynb)

–û–±–∑–æ—Ä –±–∞–ª–∞–Ω—Å–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:
![Overview distribution of all features](/EDA/distribution-high-view.jpg)

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –æ—Ç—Ç–æ–∫–∞:
![Churn rate distribution](/EDA/churn-distribution-overview.png)

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:
![Key features distribution](/EDA/feature-importance.png)

–ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π:
![Correlation matrix](/EDA/correlation-heatmap.png)

## üéõ Model training

–Ø –Ω–∞—á–∞–ª —Å —Ç—Ä—ë—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∏ –¥–≤—É—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ—Ä–µ–≤—å–µ–≤:
- LogisticRegression
- RandomForestClassifier
- AdaBoostClassifier

–ê —Ç–∞–∫–∂–µ —è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª —Å –ø–æ–¥–±–æ—Ä–æ–º –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫.

**Comparison of performance** –¥–ª—è –º–æ–¥–µ–ª–µ–π, –æ–±—É—á–µ–Ω–Ω—ã—Ö –≤ Jupyter Notebook:

![Models comparison](/EDA/model-comparison.png)

## Python scripts for data pre-processing and training

- [preprocess.py](/prediction_service/preprocess.py)
- [train_model.py](/prediction_service/train_model.py)

`train_model.py` –≤–∫–ª—é—á–∞–µ—Ç –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (—É–∂–µ 4, + DecisionTreeClassifier)
–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª GridSearchCV –∏ –∑–∞–º–µ—Ä—è–ª –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.

### :arrow_forward: Train model

1. **Run `bash deploy.sh` to build and start app container**. –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–æ–≤–æ–ª—å–Ω–æ –º–∞–ª, —Ç—Ä–µ–±—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç–æ–∂–µ, –ø–æ—ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ. –ö–æ–≥–¥–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è, –Ω–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (—Å–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ).

![docker-compose up](/screenshots/docker-compose-00.png)

–ö–æ–≥–¥–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ.

![docker-compose up](/screenshots/docker-compose-01.png)

2. –ß—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ bash train.sh, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ python train_model.py.

![Training prediction models in dockerl](/screenshots/model-training-1.png)

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π [model-training-log.txt](/model-training-log.txt)

![Training prediction models in dockerl](/screenshots/model-training-2.png)

–ü–æ–º–∏–º–æ –º–µ—Ç—Ä–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π, –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å feature_importances (–¥–æ–≤–æ–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏):

- RandomForestClassifier feature_importances_ [('lifetime', 0.27698838996957376), ('avg_class_frequency_current_month', 0.17358035523748414), ('avg_class_frequency_total', 0.13059232764546072), ('age', 0.12877142441676973), ('avg_additional_charges_total', 0.08603065630582445), ('month_to_end_contract', 0.07262567617283212), ('contract_period', 0.06602939753555674), ('group_visits', 0.014815990416864253), ('promo_friends', 0.011526449594906153), ('gender', 0.011358829946767927), ('partner', 0.010688387221120352), ('near_location', 0.010252701970989684), ('phone', 0.006739413565849998)]
- AdaBoostClassifier feature_importances_ [('avg_class_frequency_current_month', 0.26237198854705474), ('lifetime', 0.241629159201969), ('avg_class_frequency_total', 0.15802422807244257), ('age', 0.10169192525262957), ('month_to_end_contract', 0.08932121612074413), ('avg_additional_charges_total', 0.08297307156912992), ('contract_period', 0.037312429371726165), ('group_visits', 0.013162936142916568), ('near_location', 0.00800137553666316), ('promo_friends', 0.005511670184724211), ('gender', 0.0), ('partner', 0.0), ('phone', 0.0)]
- DecisionTreeClassifier feature_importances_ [('lifetime', 0.5123700362634527), ('month_to_end_contract', 0.1602593408280512), ('avg_class_frequency_current_month', 0.1366187653879427), ('age', 0.11076769351855814), ('avg_class_frequency_total', 0.07056176451506908), ('avg_additional_charges_total', 0.005709560461072738), ('contract_period', 0.0024638175534776353), ('promo_friends', 0.001071569554200247), ('phone', 0.0001774519181755518), ('gender', 0.0), ('near_location', 0.0), ('partner', 0.0), ('group_visits', 0.0)]

–ê —Ç–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏.

### :mag_right: Test prediction service

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ bash test-api.sh –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∫ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—É –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è. –ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ python test-api.py.

![Testing prediction service in dockerl](/screenshots/prediction-service-test-1.png)


